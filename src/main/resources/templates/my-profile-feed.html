<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8">
	<title>WorkWise</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<link rel="stylesheet" type="text/css" th:href="@{/css/animate.css}" href="../static/css/animate.css">
	<link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}" href="../static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" th:href="@{/css/flatpickr.min.css}" href="../static/css/flatpickr.min.css">
	<link rel="stylesheet" type="text/css" th:href="@{/css/line-awesome.css}" href="../static/css/line-awesome.css">
	<link rel="stylesheet" type="text/css" th:href="@{/css/line-awesome-font-awesome.min.css}" href="../static/css/line-awesome-font-awesome.min.css">
	<link rel="stylesheet" type="text/css" th:href="@{/vendor/fontawesome-free/css/all.min.css}" href="../static/vendor/fontawesome-free/css/all.min.css">
	<link rel="stylesheet" type="text/css" th:href="@{/css/font-awesome.min.css}" href="../static/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" th:href="@{/lib/slick/slick.css}" href="../static/lib/slick/slick.css">
	<link rel="stylesheet" type="text/css" th:href="@{/lib/slick/slick-theme.css}" href="../static/lib/slick/slick-theme.css">
	<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" href="../static/css/style.css">
	<link rel="stylesheet" type="text/css" th:href="@{/css/responsive.css}" href="../static/css/responsive.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
</head>
<body>
	<div class="wrapper" th:classappend="${post} ? overlay : ''">
		<header>
			<div class="container">
				<div class="header-data">
					<div class="logo">
						<a th:href="@{/}" title=""><img th:src="@{/images/logo.png}" alt=""></a>
					</div><!--logo end-->
					<div class="search-bar">
						<form th:action="@{/user/searchUser}" th:object="${user}" method="post">
							<input type="text" name="username" placeholder="Search...">
							<button type="submit"><i class="la la-search"></i></button>
						</form>
					</div><!--search-bar end-->
					<nav>
						<ul>
							<li>
								<a th:href="@{/}" title="">
									<span><img th:src="@{/images/icon1.png}" alt=""></span>
									Home
								</a>
							</li>
							<li>
								<a th:href="@{/user/showAllUsers}" title="">
									<span><img th:src="@{/images/icon4.png}" alt=""></span>
									Profiles
								</a>
								<ul>
									<li><a th:href="@{/user/showMyProfile}" title="">My Profile</a></li>
								</ul>
							</li>
							<li th:if="${user != null}">
								<a href="#" title="" class="not-box-open">
									<span><img th:src="@{/images/icon7.png}" alt=""></span>
									Requests
								</a>
								<div class="notification-box noti" id="notification" >
									<div class="nott-list" th:if="${user.getRequests().size() > 0}" >
										<div class="notfication-details" th:each="request : ${user.getRequests()}" th:object="${request}">
											<div class="noty-user-img">
												<img th:if="${request.getSender().getPhoto()}" style="height: 30px;width: 30px;" th:src="@{'/user/' + ${request.getSender().getId()} + '/userImage'}"  alt="">
												<img th:if="${request.getSender().getPhoto() == null}" style="height: 30px;width: 30px;" th:src="@{/images/resources/anonymous-user.png}" alt="">
											</div>
											<div class="notification-info">
												<h3><a href="#" title="" th:text="${request.sender.username}">Jassica William</a> Send you a friend request.</h3>
											</div><!--notification-info -->
										</div>
										<div class="view-all-nots">
											<a th:href="@{request/showRequests}" title="">View Requests</a>
										</div>
									</div><!--nott-list end-->
								</div><!--notification-box end-->
							</li>
							<li th:if="${user == null}">
								<a th:href="@{/login}" title="">
									<span><img th:src="@{/images/icon3.png}" alt=""></span>
									Login
								</a>
							</li>
							<li th:if="${user != null}">
								<a th:href="@{/logout}" title="">
									<span><img th:src="@{/images/icon3.png}" alt=""></span>
									Logout
								</a>
							</li>
						</ul>
					</nav><!--nav end-->
					<div class="menu-btn">
						<a th:href="@{#}" title=""><i class="fa fa-bars"></i></a>
					</div><!--menu-btn end-->
					<div class="user-account">
						<div class="user-info" th:if="${user != null}">
							<img th:if="${user.getPhoto()}" style="height: 30px;width: 30px;" th:src="@{'/user/' + ${user.getId()} + '/userImage'}"  alt="">
							<img th:if="${user.getPhoto() == null}" style="height: 30px;width: 30px;" th:src="@{/images/resources/anonymous-user.png}" alt="">
							<a href="#" th:text="${#authentication.name == 'anonymousUser' ? '' : #authentication.name}"></a>
						</div>
					</div>
				</div><!--header-data end-->
			</div>
		</header><!--header end-->
		<section class="cover-sec" th:if="${user != null}">
			<img th:if="${user.coverPhoto}" style="height: 450px;width: 1600px;" th:src="@{'/user/' + ${user.getId()} + '/coverImage'}"  alt="">
			<img th:if="${user.coverPhoto == null}" style="height: 450px;width: 1600px;" th:src="@{/images/resources/cover-default.jpg}" alt="">
			<div class="add-pic-box">
				<div class="container">
					<div class="row no-gutters">
						<div class="col-lg-12 col-sm-12">
							<form action="#" th:action="@{/user/changeCoverPhoto}" th:object="${user}" method="post" enctype="multipart/form-data">
							<input name="coverPhoto" type="file" id="coverPhoto">
								<label for="coverPhoto">Browse</label>
								<button type="submit" class="btn btn-primary"><i></i>Update</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</section>
		<main>
			<div class="main-section">
				<div class="container">
					<div class="main-section-data">
						<div class="row">
							<div class="col-lg-3 col-md-4 pd-left-none no-pd">
								<div class="main-left-sidebar">
									<div class="user-data full-width">
										<div class="user_profile">
											<div class="user-pro-img" th:if="${user != null}">
												<img th:if="${user.getPhoto()}" style="height: 200px;width: 200px;" th:src="@{'/user/' + ${user.getId()} + '/userImage'}"  alt="">
												<img th:if="${user.getPhoto() == null}" style="height: 200px;width: 200px;" th:src="@{/images/resources/anonymous-user.png}" alt="">
											</div>
											<form action="#" th:action="@{/user/changeProfilePicture}" th:object="${user}" method="post" enctype="multipart/form-data">
												<div class="add-pic-box">
													<div class="container">
														<div class="row no-gutters" style="margin-left: 27px;">
															<div class="col-lg-10">
																<input name="profilePicture" type="file" id="profilePicture">
																<label for="profilePicture">Browse</label>
															</div>
														</div>
													</div>
												</div>
												<button type="submit" class="btn btn-primary"><i></i>Update</button>
											</form>
											<div class="user-specs">
												<ul class="user-fw-status">
													<li>
														<span th:text=" ${user.getJobTitle()}">Graphic Designer at Self Employed</span>
													</li>
													<li>
														<span th:text="${friendsCounter + ' Friends'}" >Friends</span>
													</li>
													<li>
														<a th:href="@{/user/showMyFriends/{id}(id=${user.id})}" >Show friends</a>
													</li>
												</ul>
											</div>

										</div><!--user-profile end-->
									</div><!--user_profile end-->
								</div><!--main-left-sidebar end-->
							</div>
							<div class="col-lg-6">
								<div class="main-ws-sec">
									<div class="user-tab-sec">
										<div>
											<h3 th:text=" ${user.getFirstName()}" ></h3>
											<h3 th:text=" ${user.getLastName()}" ></h3>
                                            <div class="tab-feed st2 settingjb">
											<ul>
												<li data-tab="feed-dd" class="active">
													<a th:href="@{/user/showUserProfile/{id}(id=${user.id})}" title="">
														<img th:src="@{/images/ic1.png}" alt="">
														<span>Feed</span>
													</a>
												</li>
												<li data-tab="info-dd">
													<a th:href="@{/user/my/info/{id}(id=${user.id})}" title="">
														<img th:src="@{/images/ic2.png}" alt="">
														<span>Info</span>
													</a>
												</li>
											</ul>
										</div>
									</div><!-- tab-feed end-->
										<div th:if="${!isInfo}" class="product-feed-tab current" id="feed-dd">
											<div class="message-btn" style="float: left;">
												<a th:href="@{/user/edit}" href="user-settings.html" title=""><i class="fas fa-cog"></i> Edit Profile</a>
											</div>
											<div class="post-topbar" sec:authorize="hasRole('ROLE_USER')">
												<div class="user-picy" th:if="${user != null}" >
													<img th:if="${user.getPhoto()}" style="height: 50px;width: 50px;" th:src="@{'/user/' + ${user.getId()} + '/userImage'}"  alt="">
													<img th:if="${user.getPhoto() == null or user == null}" style="height: 50px;width: 50px;" th:src="@{/images/resources/anonymous-user.png}" alt="">
												</div>
											<div class="post-st">
												<ul>
													<li>
														<a class="active" th:href="@{/user/post/new}" title="">Post</a>
													</li>
												</ul>
											</div><!--post-st end-->
										</div><!--post-topbar end-->
											<div class="posts-section">
												<div class="posty" th:each="post, iter : ${myPosts}" style="margin-bottom: 10px;">
													<div class="post-bar no-margin">
														<div class="post_topbar">
															<div class="usy-dt" >
																<img th:if="${post.createdBy.getPhoto()}" style="height: 50px;width: 50px;" th:src="@{'/user/' + ${post.createdBy.getId()} + '/userImage'}"  alt="">
																<img th:if="${post.createdBy.getPhoto() == null or user == null}" style="height: 50px;width: 50px;" th:src="@{/images/resources/anonymous-user.png}" alt="">
																<div class="usy-name">
																	<h3><a th:text="${post.createdBy.username}" th:href="@{/user/showUserProfile/{id}(id=${post.createdBy.id})}">John Doe</a></h3>
																	<span th:text="${#temporals.format(post.getDateTime(), 'dd-MM-yyyy HH:mm')}">
																		<img th:src="@{/images/clock.png}" alt="">3 min ago
																	</span>
																</div>
															</div>
															<div class="ed-opts" th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')') or #authentication.name == post.createdBy.username}">
																<a href="#" title="" class="ed-opts-open"><i class="la la-ellipsis-v"></i></a>
																<ul class="ed-options">
																	<li><a th:href="@{'/post/edit/' + ${post.id}}" title="">Edit Post</a></li>
																	<li><a href="#" th:onclick="|completeAndRedirect('${post.id}', '*{iter.index}')|" title="">Delete post</a></li>
																	<form style="visibility: hidden; max-height: 0" th:id="*{iter.index}" action="javascript:void(0)" method="post">
																		<button class="btn btn-danger" type="submit">Delete Post</button>
																	</form>
																</ul>
															</div>
														</div>
														<div class="epi-sec">
															<ul class="descp">
																<li><img th:src="@{/images/icon9.png}" alt=""><span>Bulgaria</span>
															</ul>
														</div>
														<div class="job_descp">
															<p th:text="${post.text}">Lorem ipsum dolor sit amet <a href="#" title="">view more</a></p>
														</div>
														<div class="job-status-bar">
															<ul class="like-com">
																<li>
																	<a th:if="${!post.isLiked()}" th:href="@{'/like/'+ ${post.getId()}}"><i class="fas fa-heart"></i> Like</a>
																	<a th:if="${post.isLiked()}" th:href="@{'/dislike/'+ ${post.getId()}}"><i class="fas fa-heart"></i> DisLike</a>
																	<img th:src="@{/images/liked-img.png}" alt="">
																	<span th:text=" ${post.getLikes().size()}">Likes</span>
																</li>
																<li><a href="#" th:text=" ${post.getComments().size() + '  Comments'}" class="com"><i class="fas fa-comment-alt"></i> Comment 15</a></li>
															</ul>
															<!--													<a href="#"><i class="fas fa-eye"></i>Views 50</a>-->
														</div>
													</div><!--post-bar end-->
													<div class="comment-section">
														<div th:if="${post.getComments().size() > 0}">
															<ul>
																<li th:each="comment : ${post.getComments()}">
																	<div class="comment-list">
																		<div class="bg-img">
																			<img th:src="@{/images/resources/bg-img1.png}"
																				 alt="">
																		</div>
																		<div class="comment">
																			<img th:if="${comment.getUser().getPhoto()}" style="height: 40px;width: 40px;" th:src="@{'/public/user/' + ${comment.getUser().getId()} + '/userImage'}"  alt="">
																			<img th:if="${comment.getUser().getPhoto() == null}" style="height: 40px;width: 40px;" th:src="@{/images/resources/anonymous-user.png}" alt="">
																			<h3><a th:text="${comment.getUser().getUsername()}" th:href="@{/user/showUserProfile/{id}(id=${comment.getUser().getId()})}"></a></h3>
																			<span th:text="${#temporals.format(comment.getDateTime(), 'dd-MM-yyyy HH:mm')}"><img th:src="@{/images/clock.png}" alt=""></span>
																			<p th:text="${comment.getDescription()}">Lorem ipsum dolor sit amet, </p>
																		</div>
																		<div class="ed-opts" th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')') or #authentication.name == comment.getUser().username}">
																			<a href="#" title="" class="ed-opts-open" ><i class="la la-ellipsis-v"></i></a>
																			<ul class="ed-options" th:if="active">
																				<li><a th:href="@{'/comment/edit/myprofile/' + ${comment.id}}" href="#" title="">Edit Comment</a></li>
																				<li><a href="#" th:onclick="|completeAndRedirectComment('${comment.id}', '*{iter.index  + 1000}')|" title="">Delete comment</a></li>
																				<form style="visibility: hidden; max-height: 0" th:id="*{iter.index  + 1000}" action="javascript:void(0)" method="post">
																					<button class="btn btn-danger" type="submit">Delete Comment</button>
																				</form>
																			</ul>
																		</div>
																	</div><!--comment-list end-->
																</li>
															</ul>
														</div>
														<div class="comment-sec"
															 th:if="${post.getComments().size() == 0}">
															<p>No comments</p>
														</div>
														<!--comment-sec end-->
														<div class="post-comment" sec:authorize="hasRole('ROLE_USER')">
															<div class="comment_box">
																<form th:action="@{'/comment/user/add/' + ${post.id}}" method="post" th:object="${newComment}">
																	<input type="text" placeholder="Post a comment" th:field="*{description}">
																	<button type="submit">Send</button>
																</form>
															</div>
														</div><!--post-comment end-->
													</div><!--comment-section end-->
												</div>
											</div><!--posts-section end-->
										</div><!--main-ws-sec end-->
										<div th:else class="product-feed-tab" id="info-dd">
											<div class="user-profile-ov">
												<h3>User Information</h3>
												<h4>Name</h4>
												<h5 th:text="${user.getUsername()}"></h5>
												<span></span>
												<span></span>
												<h4>Age</h4>
												<h5 th:text="${user.getAge()}"></h5>
												<span></span>
												<span></span>
												<h4>Job Title</h4>
												<h5 th:text=" ${user.getJobTitle()}" >Job</h5>
												<span></span>
												<span></span>
												<h4>Email</h4>
												<h5 th:text=" ${user.getEmail()}" >Email</h5>
												<span></span>
												<span></span>
											</div><!--user-profile-ov end-->
										</div>
									</div>
								</div>
							</div><!-- main-section-data end-->
						</div>
					</div>
				</div>
			</div>
		</main>

		<div th:if="${post}" class="post-popup job_post" th:classappend="${post} ? active : ''">
			<div class="post-project">
				<h3 th:text="${post.id > 0} ? 'Edit post' : 'Create new post'">Create new post</h3>
				<div class="post-project-fields">
					<form action="#" th:action="${post.id > 0} ? '/post/user/update/' + ${post.id} : '/post/user/add'" method="post" th:object="${post}">
						<div class="row">
							<div class="col-lg-12">
								<textarea name="description" placeholder="Description" th:field="${post.text}"></textarea>
							</div>
							<div class="col-lg-12">
								<input type="checkbox" style="width: auto;height: auto;margin: auto" name="cc" id="c1" th:field="${post.isPublic}">
								<label for="c1">
									Make post public?
								</label>
							</div>
							<div class="col-lg-12">
								<ul>
									<li>
										<button class="active" type="submit" value="post" th:text="${post.id > 0} ? 'Edit' : 'Post'"></button>
									</li>
									<li><a title="" th:href="@{/user/showMyProfile}">Cancel</a></li>
								</ul>
							</div>
						</div>
					</form>
				</div><!--post-project-fields end-->
			</div><!--post-project end-->
		</div><!--post-project-popup end-->

		<div th:if="${comment}" class="post-popup job_post" th:classappend="${comment} ? active : ''">
			<div class="post-project">
				<h3 th:text="'Edit comment'">Edit comment</h3>
				<div class="post-project-fields">
					<form action="#" th:action=" '/comment/edit/myprofile/' + ${comment.id}" method="post" th:object="${comment}">
						<div class="row">
							<div class="col-lg-12">
								<textarea name="description" placeholder="Description" th:field="${comment.description}"></textarea>
							</div>
							<div class="col-lg-12">
								<ul>
									<li>
										<button class="active" type="submit" value="post" th:text="'Edit'"></button>
									</li>
									<li><a href="#" title="" th:href="@{/user/showMyProfile}">Cancel</a></li>
								</ul>
							</div>
						</div>
					</form>
				</div><!--post-project-fields end-->
			</div><!--post-project end-->
		</div>
	</div><!--theme-layout end-->
	<script>
		function completeAndRedirect(postId, elementId){
			let r = confirm("Are you sure you want to delete this post?");
			if (r == true) {
				document.getElementById(elementId).action = '/post/user/delete/' + postId;
				document.getElementById(elementId).submit();
			}
		}
	</script>

	<script>
		function completeAndRedirectComment(commentId, elementId){
			let c = confirm("Are you sure you want to delete this comment?");
			if (c == true) {
				document.getElementById(elementId).action = '/comment/delete/myprofile/' + commentId;
				document.getElementById(elementId).submit();
			}
		}

	</script>
	<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/popper.js}"></script>
	<script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/flatpickr.min.js}"></script>
	<script type="text/javascript" th:src="@{/lib/slick/slick.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/script.js}"></script>
</body>
</html>